---
title: Structure sur disque
draft: false
tags:
  - SysExploitation
---
# Exemple de structure simple d'un FS.

Voici un FS de 64 [[Stratégies d'allocation#Stratégies d'allocation des blocs de données|blocs]].

![[Pasted image 20241017135343.png]]

**Le bloc 0 est réservé.** Il contient le secteur de boot et la table de partitions.

![[Pasted image 20241017135425.png]]

Si on veut stocker des données, on voudrait que **la majorité des blocs** soient des blocs de données. Donc on les reserves pour ça.

![[Pasted image 20241017135505.png]]
## Bitmap de blocs

**Le bitmap de blocs**, qui est un tableau de bits, (qui contient autant de bits qu'ils y'a de blocs de données) permet de dire quels blocs de données sont disponibles/utilisés.

![[Pasted image 20241017135648.png]]

Imaginons le FS suivant :

![[Pasted image 20241017135823.png]]

- Il y'a trois blocs de données utilisés (ceux en bleu) : 2, 3 et 6
- **Le bitmap =** $0\ 0\ 1\ 1\ 0\ 0\ 1\ 0\ 0...$
# Association blocs de données  $\iff$ Fichier

**Fonction principale des inodes** : Les [[Inodes]] permettent d'associer les blocs de données aux fichiers dans un système de fichiers (FS).

**Stockage des inodes** :
- Les inodes sont regroupés et stockés de manière contiguë au début du système de fichiers, dans une structure appelée **[[Structure sur disque#Table d'inode|table d'inode]]**.

**Taille des inodes** :
- La taille de chaque inode est fixe pour un FS donné.
- Cette taille varie en fonction du type de FS et est définie lors de sa création.
- Un petit système de fichiers aura des inodes plus petits par rapport à un système plus grand, ce qui est logique en raison de la différence de capacité de stockage.

![[Pasted image 20241017141600.png]]
#### Question : Soit des blocs de 4kB et une taille d'inode de 128 bytes, combien d'inodes par blco ?
$$\large{4096\ \text{bytes} / 128\ \text{bytes} = 32\ \text{inodes par bloc}}$$
# Table d'inode

Example d'une table d'inode de 2 blocs (taille de blocs 2kB, taille d'inode 128 bytes => 16 inodes par blocs)

![[Pasted image 20241017141824.png]]

> [!Warning] Indexage des inodes
> Les inodes sont indexés à 1
# Relation Fichier $\iff$ Inodes

Chaque inode est associé à **un seul** inode. Chaque **numéro d'inode est unique** à un FS donnée.
Des FS différents peuvent utiliser les mêmes numéros d'inode.
Lorsqu'on supprime un fichier, on peut réutiliser le numéro d'inode qui lui était associé.
# Allocation des blocs de données dans un inode

10 pointeurs directs, 1 pointeur indirect, 1 pointeur doublement indirect et 1 pointeur triplement indirect.

![[Pasted image 20241017142231.png]]
# Contenu des fichiers
## Fichier régulier vs type répertoire.

- **Régulier** : fichier habituel avec un contenu (text, image, audio etc...)
- **Répertoire** : fichier directory* qui contient des [[Directories (répertoires)#Structure **dirent**|directory entries*]] 
# Contenu d'un répertoire

Contient des entrées de [[Directories (répertoires)|répertoires]]. Par contention, **l'inode 1** est le répertoire **racine du FS** 
![[Pasted image 20241017143421.png]]